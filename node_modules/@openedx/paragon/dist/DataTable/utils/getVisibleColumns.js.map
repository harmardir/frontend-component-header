{"version":3,"file":"getVisibleColumns.js","names":["React","useMemo","useContext","useEffect","CheckboxControl","DataTableContext","useConvertIndeterminateProp","selectColumn","id","Header","_ref","getToggleAllPageRowsSelectedProps","getToggleAllRowsSelectedProps","page","_useContext","isSelectable","maxSelectedRows","toggleRowsSelectedProps","getToggleRowsSelectedProps","updatedProps","formatMaxSelectedRows","Math","max","createElement","className","_extends","Cell","_ref2","_selectedRowsOrdered","row","_useContext2","onMaxSelectedRows","_useContext2$state","state","selectedRowIds","selectedRowsOrdered","getToggleRowSelectedProps","index","isRowSelected","selectedRowsLength","Object","keys","length","hasMaxSelectedRows","disableCheck","lastRowSelected","disabled","disableSortBy","getVisibleColumns","visibleColumns","additionalColumns","arguments","undefined","manualSelectColumn","columns","push","concat"],"sources":["../../../src/DataTable/utils/getVisibleColumns.jsx"],"sourcesContent":["import React, { useMemo, useContext, useEffect } from 'react';\n\nimport { CheckboxControl } from '../../Form';\nimport DataTableContext from '../DataTableContext';\nimport useConvertIndeterminateProp from './useConvertIndeterminateProp';\n\nexport const selectColumn = {\n  id: 'selection',\n  // The header can use the table's getToggleAllPageRowsSelectedProps or getToggleAllRowsSelectedProps\n  // method to render a checkbox. The method is determined based on whether pagination is enabled or\n  // not (i.e., ``page`` is defined).\n  // Proptypes disabled as these props are passed in separately\n  /* eslint-disable-next-line react/prop-types */\n  Header: ({ getToggleAllPageRowsSelectedProps, getToggleAllRowsSelectedProps, page }) => {\n    const { isSelectable, maxSelectedRows } = useContext(DataTableContext);\n    const toggleRowsSelectedProps = useMemo(\n      () => {\n        // determine if this selection is for an individual page or the entire table\n        const getToggleRowsSelectedProps = page ? getToggleAllPageRowsSelectedProps : getToggleAllRowsSelectedProps;\n        return getToggleRowsSelectedProps();\n      },\n      [getToggleAllPageRowsSelectedProps, getToggleAllRowsSelectedProps, page],\n    );\n    const updatedProps = useConvertIndeterminateProp(toggleRowsSelectedProps);\n    const formatMaxSelectedRows = Math.max(0, maxSelectedRows);\n\n    if (isSelectable && formatMaxSelectedRows >= 0) {\n      return null;\n    }\n\n    return (\n      <div className=\"pgn__data-table__controlled-select\">\n        <CheckboxControl\n          {...updatedProps}\n          data-testid=\"datatable-select-column-checkbox-header\"\n        />\n      </div>\n    );\n  },\n  // The cell can use the individual row's getToggleRowSelectedProps method\n  // to the render a checkbox\n  // Proptypes disabled as this prop is passed in separately\n  /* eslint-disable react/prop-types */\n  Cell: ({ row }) => {\n    const {\n      isSelectable, maxSelectedRows, onMaxSelectedRows, state: { selectedRowIds, selectedRowsOrdered },\n    } = useContext(DataTableContext);\n    const updatedProps = useConvertIndeterminateProp(row.getToggleRowSelectedProps());\n    const { index } = row;\n    const isRowSelected = index in selectedRowIds;\n    const selectedRowsLength = Object.keys(selectedRowIds).length;\n    const formatMaxSelectedRows = Math.max(0, maxSelectedRows);\n    const hasMaxSelectedRows = formatMaxSelectedRows === selectedRowsLength;\n    const disableCheck = isSelectable && hasMaxSelectedRows && !isRowSelected;\n    const lastRowSelected = selectedRowsOrdered?.[selectedRowsOrdered.length - 1] ?? null;\n\n    useEffect(() => {\n      if (hasMaxSelectedRows && lastRowSelected === index) {\n        onMaxSelectedRows?.();\n      }\n    }, [hasMaxSelectedRows, index, isRowSelected, lastRowSelected, onMaxSelectedRows, selectedRowIds]);\n\n    return (\n      <div className=\"pgn__data-table__controlled-select\">\n        <CheckboxControl\n          {...updatedProps}\n          disabled={disableCheck}\n          data-testid=\"datatable-select-column-checkbox-cell\"\n        />\n      </div>\n    );\n  },\n  /* eslint-enable react/prop-types */\n  disableSortBy: true,\n};\n\nconst getVisibleColumns = (\n  isSelectable,\n  visibleColumns,\n  additionalColumns = [],\n  manualSelectColumn = selectColumn,\n) => {\n  let columns = [];\n  if (isSelectable) {\n    columns.push(manualSelectColumn);\n  }\n  columns = columns.concat(visibleColumns);\n  if (additionalColumns.length > 0) {\n    columns = columns.concat(additionalColumns);\n  }\n  return columns;\n};\n\nexport default getVisibleColumns;\n"],"mappings":"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","ignoreList":[]}